# Hackathon Builder

Firebase と SSR (Server Side Rendering) を活用した、チラつきのない高速なハッカソン管理・公開システムです。

## 🌟 特徴

- **高速表示 (SSR)**: クラウド側でHTMLを組み立ててから届けるため、アクセスした瞬間に内容が表示されます（SEOに強く、SNSシェア時のOGPも完璧です）。
- **簡単編集**: 専用の管理画面から、エンジニアでなくてもサイト内容（ヒーロー/審査員/スポンサー等）をリアルタイムで更新できます。
- **参加者管理**: 登録者の閲覧、修正、削除、CSVエクスポートが管理画面から一括で行えます。
- **安心の認証**: Google アカウントに加え、専用の ID/パスワードによる管理者認証もサポート。
- **一元管理**: 全てのデータは Firestore に保存され、IndexedDB などのローカル保存は使用しません。

---

## 🏗 システム構成

**Hackathon Builder** は、Firebase をフル活用したモダンな高パフォーマンス・アーキテクチャを採用しています。

- **SSR (Server Side Rendering)**: Cloud Functions がリクエストを受け取り、Firestore の最新データや Storage の画像を注入した HTML を即座に生成します。これにより、爆速の初回表示と、SNS シェア時の完璧な OGP 対応を実現しています。
- **統合管理**: 構造化データは **Cloud Firestore**、OGP 画像などのアセットは **Firebase Storage** で一元管理され、管理画面からシームレスに操作可能です。
- **セキュリティ**: すべての操作は Firebase Auth による認証と、強固なセキュリティルールによって適切に制御されています。

![システム構成](./assets/hackathon_builder_system_arch.png)

---

## 🚀 構築・公開手順 (10分)

### 1. リポジトリのクローン

```bash
git clone https://github.com/kkitase/hackathon-builder.git
cd hackathon-builder
```

### 2. Firebase プロジェクトの作成

[Firebase Console](https://console.firebase.google.com/) で新しいプロジェクトを作成します。

1. 「新しい Firebase プロジェクトを作成」をクリック
2. プロジェクト名を入力（例: `my-hackathon`）
3. Google Analytics は任意で設定
4. 「プロジェクトを作成」をクリック

### 3. Firebase サービスの有効化

作成したプロジェクトで、以下のサービスを有効化します：

| サービス | 設定手順 |
|---------|---------|
| **Firestore** | 構築 → 「Firestore Database」→ データベースの作成 → Standard エディション →`asia-northeast1` → 本番環境モードで開始する |
| **Authentication** | 構築 → 「Authentication」→ 始める → **Google** →　プロジェクトのサポートメールの設定 →　有効にする |
| **Storage** | 構築 → 「Storage」→ プロジェクトをアップグレード → Cloud請求先アカウントを構築する → Cloud請求先アカウントをリンク → 使ってみる → すべてのロケーション →`asia-northeast1` → 本番環境モードで開始する |

> ⚠️ **Storage と Cloud Functions を使用するには Blaze プラン（従量制）へのアップグレードが必要です。Google Cloud の課金アカウントを設定してください。小〜中規模のサイトであれば費用はほとんどかかりませんが、利用状況により課金が発生する場合があります。ご了承ください。**

### 4. サービスアカウントキーのダウンロード

1. Firebase Console → ⚙️ プロジェクト設定 → 「サービスアカウント」タブ
2. 「新しい秘密鍵の生成」をクリック
3. ダウンロードしたファイルを `serviceAccountKey.json` として、ルートフォルダに配置

### 5. 初期化

```bash
# 対話形式で初期化（作成したFirebaseプロジェクトを選択）
npm run init
```

`npm run init` は以下を対話形式で行います：
1. 依存関係のインストール
2. Firebase CLI のセットアップ
3. **作成済みプロジェクトの選択**
4. `firebase.js` の自動生成
5. 管理者アカウントの設定

### 6. デプロイ

```bash
# ビルドとデプロイ
npm run deploy
```

> **📝 初回デプロイ時の確認**
> - 「Cloud Storage for Firebase needs an IAM Role...」→ `Y` を入力
> - 「How many days do you want to keep container images...」→ `1` を入力

---

## 📝 運用方法

- **管理画面**: デプロイされたURLの `/admin.html` にアクセスしてください。
- **ログイン**: 
  - **ID/Pass**: `初期設定時の userid` / `password`
  - **Google**: 許可されたメールアドレスでサインイン可能。
- **更新**: 各タブの内容を編集して「保存」を押すと、即座に公開サイトに反映されます。
- **プロジェクト（参加者）管理**: 「プロジェクト」タブから登録者情報の修正、削除、CSVダウンロードが可能です。
- **参加者交流**: プロジェクト一覧での「いいね」・「コメント」が可能です。
    - 「◯人がいいね」をクリックして詳細（参加者の名前・所属）を確認できます。
- **参加者の自己編集**: ログインしたユーザーは自分のプロジェクト情報を編集・取り下げできます。
- **検索エンジン・OGP設定**: 「Social」タブの「検索エンジンに公開する」で制御可能です。OGP画像はローカルから直接アップロードして設定できます。
- **ログアウト**: サイドバー最下部のリンク、またはヘッダーからログアウトできます。

---

## 🛠 開発者向け
- **開発サーバー**: `npm run dev` でローカル確認が可能です。
- **セットアップツール**: `tools/` フォルダに初期設定用のスクリプトがまとめられています。
- **セキュリティルール**: `firestore.rules` で管理者以外の書き込みを禁止しています。
- **SSRテンプレート**: `functions/template.html` が SSR のベースとなります。
